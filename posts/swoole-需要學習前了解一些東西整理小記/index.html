<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>swoole 需要學習前了解一些東西整理小記 - 程式狂想筆記</title><meta name="Description" content="記錄著我接觸程式藝文"><meta property="og:url" content="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/">
  <meta property="og:site_name" content="程式狂想筆記">
  <meta property="og:title" content="swoole 需要學習前了解一些東西整理小記">
  <meta property="og:description" content="最近一時衝動報名 swoole 課程
我對高併發實作還滿感興趣
好奇怎麼運用一些方法解決
今天看了 學習Swoole需要掌握哪些基礎知識-Swoole-Swoole文檔中心 發現裡面很多名詞不會
不想浪費錢，趕快臨時抱佛腳">
  <meta property="og:locale" content="zh-tw">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-09-20T22:44:54+00:00">
    <meta property="article:modified_time" content="2019-09-20T22:44:54+00:00">
    <meta property="article:tag" content="Swoole">
    <meta property="article:tag" content="Php">
<meta name="twitter:card" content="summary"><meta name="twitter:title" content="swoole 需要學習前了解一些東西整理小記">
<meta name="twitter:description" content="最近一時衝動報名 swoole 課程
我對高併發實作還滿感興趣
好奇怎麼運用一些方法解決
今天看了 學習Swoole需要掌握哪些基礎知識-Swoole-Swoole文檔中心 發現裡面很多名詞不會
不想浪費錢，趕快臨時抱佛腳">
<meta name="application-name" content="程式狂想筆記">
<meta name="apple-mobile-web-app-title" content="程式狂想筆記"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" /><link rel="prev" href="https://malagege.github.io/blog/posts/CSS-fullscreen-%E5%85%A8%E8%9E%A2%E5%B9%95%E5%8A%9F%E8%83%BD%E5%B0%8F%E8%A8%98/" /><link rel="next" href="https://malagege.github.io/blog/posts/MySQL-%E6%88%91%E5%B0%8D-timestamp-%E5%A4%9A%E5%B9%B4%E7%9A%84%E8%AA%A4%E8%A7%A3/" /><link rel="stylesheet" href="/blog/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "swoole 需要學習前了解一些東西整理小記",
        "inLanguage": "zh-tw",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/malagege.github.io\/blog\/posts\/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98\/"
        },"genre": "posts","keywords": "swoole, php","wordcount":  636 ,
        "url": "https:\/\/malagege.github.io\/blog\/posts\/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98\/","datePublished": "2019-09-20T22:44:54+00:00","dateModified": "2019-09-20T22:44:54+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "malagege"
            },"description": "\u003cp\u003e最近\u003cdel\u003e一時衝動\u003c/del\u003e報名 swoole 課程\u003cbr\u003e\n我對高併發實作還滿感興趣\u003cbr\u003e\n好奇怎麼運用一些方法解決\u003cbr\u003e\n今天看了 \u003ca href=\"https://wiki.swoole.com/wiki/page/487.html\" target=\"_blank\" rel=\"noopener noreffer \"\u003e學習Swoole需要掌握哪些基礎知識-Swoole-Swoole文檔中心\u003c/a\u003e 發現裡面很多名詞不會\u003cbr\u003e\n不想浪費錢，趕快臨時抱佛腳\u003c/p\u003e"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/blog/" title="程式狂想筆記">程式狂想筆記</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/blog/"> 首頁 </a><a class="menu-item" href="/blog/posts/"> 文章 </a><a class="menu-item" href="/blog/tags/"> 標籤 </a><a class="menu-item" href="/blog/categories/"> 分類 </a><a class="menu-item" href="/blog/links/" title="覺得不錯好站都會放在這邊"> 好站連結 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/blog/" title="程式狂想筆記">程式狂想筆記</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/blog/" title="">首頁</a><a class="menu-item" href="/blog/posts/" title="">文章</a><a class="menu-item" href="/blog/tags/" title="">標籤</a><a class="menu-item" href="/blog/categories/" title="">分類</a><a class="menu-item" href="/blog/links/" title="覺得不錯好站都會放在這邊">好站連結</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
            <div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="4661282975"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">swoole 需要學習前了解一些東西整理小記</h1>

        <div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="2236653478"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  <div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/blog/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>malagege</a></span>&nbsp;<span class="post-category">included in <a href="/blog/categories/PHP/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>PHP</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2019-09-20">2019-09-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;636 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#多進程多線程">多進程/多線程</a>
      <ul>
        <li><a href="#程序-與-執行緒差別">程序 與 執行緒差別</a></li>
        <li><a href="#瞭解進程間通信的基本知識如管道unixsocket消息隊列共享內存">瞭解進程間通信的基本知識，如管道、UnixSocket、消息隊列、共享內存</a></li>
      </ul>
    </li>
    <li><a href="#socket">SOCKET</a>
      <ul>
        <li><a href="#file-descriptorsfd">file descriptors(fd)</a></li>
        <li><a href="#socket-跟-fd-關係">socket 跟 fd 關係?</a></li>
        <li><a href="#acceptconnectsendrecvcloselistenbind">accept/connect、send/recv、close、listen、bind</a></li>
        <li><a href="#接收緩存區發送緩存區阻塞非阻塞超時等概念">接收緩存區、發送緩存區、阻塞/非阻塞、超時等概念</a></li>
      </ul>
    </li>
    <li><a href="#io复用">IO复用</a>
      <ul>
        <li><a href="#同步異步阻塞非阻塞">同步、異步、阻塞、非阻塞</a></li>
        <li><a href="#linux-io">LINUX IO</a></li>
      </ul>
    </li>
    <li><a href="#應用">應用</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>最近<del>一時衝動</del>報名 swoole 課程<br>
我對高併發實作還滿感興趣<br>
好奇怎麼運用一些方法解決<br>
今天看了 <a href="https://wiki.swoole.com/wiki/page/487.html" target="_blank" rel="noopener noreffer ">學習Swoole需要掌握哪些基礎知識-Swoole-Swoole文檔中心</a> 發現裡面很多名詞不會<br>
不想浪費錢，趕快臨時抱佛腳</p>
<p>本篇是我找來資訊，看到的內容打成自己的感想，所以也不是很正確的東西，反正是我自己筆記!!</p>
<h2 id="多進程多線程">多進程/多線程</h2>
<p>多年來有看到執行緒跟多程序執行的差別，今天終於可以好好的想一下</p>
<h3 id="程序-與-執行緒差別">程序 與 執行緒差別</h3>
<p>其實很久以前有想這個問題，但一直沒有找解答<br>
我有想出兩個差別，可以共用全域變數，另外一個不行<br>
今天我又有更多想法，多程序吃的記憶體資源會比多執行緒吃的多<br>
畢竟1個 electron 跟開 1000 個 electron 是有差的&hellip;<br>
但我看到還有一個答案，就是多執行緒可以等待結束在進行下一個動作</p>
<p>詳細可看<a href="https://medium.com/@totoroLiu/program-process-thread-%E5%B7%AE%E7%95%B0-4a360c7345e5" target="_blank" rel="noopener noreffer ">Program/Process/Thread 差異 - Po-Ching Liu - Medium</a></p>
<h4 id="fork-子程序">fork 子程序</h4>
<p>前陣子看了鳥哥<a href="http://linux.vbird.org/linux_basic/0440processcontrol.php#parent_pid" target="_blank" rel="noopener noreffer ">鳥哥的 Linux 私房菜 &ndash; 第十六章、程序管理與 SELinux 初探</a>這篇<br>
看不太懂 <code>fork and exec：程序呼叫的流程</code><br>
上課講到用 PHP 寫子程序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pid</span> <span class="o">=</span> <span class="nx">pcntl_fork</span><span class="p">();</span> <span class="c1">//在這裡開始產生程式的分岔   ##**
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">die</span><span class="p">(</span><span class="s1">&#39;無法產生子程序&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// 父程序會進入這裡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// 子程序會進入這裡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>做到上面<code>##**</code> 註解這行<br>
它會做fork 主程序，也就是複製整份主程序記憶體所有程式內容<br>
複製出來並不會跟主程序做關聯(會獨立出來)<br>
變數更動不影響別的子程序和父程序</p>
<p>但沒法用一般 kill 指令調<br>
一般正常可以</p>
<p><a href="https://www.php.net/manual/en/function.posix-setsid.php" target="_blank" rel="noopener noreffer ">PHP: posix_setsid - Manual</a></p>
<h3 id="瞭解進程間通信的基本知識如管道unixsocket消息隊列共享內存">瞭解進程間通信的基本知識，如管道、UnixSocket、消息隊列、共享內存</h3>
<p>這個我就沒特別找了</p>
<ul>
<li><a href="https://blog.csdn.net/Swallow_he/article/details/84392285" target="_blank" rel="noopener noreffer ">TCP/UDP的接收緩衝區和發送緩衝區 - Swallow_he的博客 - CSDN博客</a></li>
<li><a href="https://github.com/jasonGeng88/blog/blob/master/201705/MQ.md" target="_blank" rel="noopener noreffer ">一個故事告訴你什麼是消息隊列 · jasonGeng88/blog</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/37808566" target="_blank" rel="noopener noreffer ">进程间的通信方式（一）：共享内存 - 知乎</a></li>
</ul>
<h2 id="socket">SOCKET</h2>
<blockquote>
<p>瞭解SOCKET的基本操作如accept/connect、send/recv、close、listen、bind<br>
瞭解SOCKET的接收緩存區、發送緩存區、阻塞/非阻塞、超時等概念</p>
</blockquote>
<p>之前我有在 Java 書看到使用 socket 搭配執行緒做連線溝通<br>
但沒有深入了解裡面原理</p>
<blockquote>
<p>你一直聽到人家在講 &ldquo;sockets&rdquo;，你可能也想知道這些是什麼東西。<br>
好的，其實它們就是：＂利用標準 UNIX file descriptors（檔案描述符）與其它程式溝通的一種方式＂。<br>
<a href="http://beej-zhtw.netdpi.net/02-what-is-socket" target="_blank" rel="noopener noreffer ">02-何謂 Socket - Beej&rsquo;s Guide to Network Programming 正體中文版</a></p>
</blockquote>
<h3 id="file-descriptorsfd">file descriptors(fd)</h3>
<p>這邊有講到 <code>file descriptors</code> (fd) 後面會講到這個<br>
簡單說 就是 0 標準輸出(stdout) 1 標準輸入(stdin) 2 標準錯誤(stderr)</p>
<p>一些重要的I/O導向:</p>
<blockquote>
<p>&gt;      重新導向並且先把檔案虧空(我真是敗家子:-))<br>
&gt;&gt;     把結果導向並且append到檔案後<br>
&lt;      重新導向standard input<br>
&gt;&amp;n    把standard out丟給file descriptor n<br>
&lt;&amp;n    從file descriptor n拿東西給standard in<br>
&gt;&amp;-    close standard out<br>
&lt;&lt;\text 把stanadard in導向，直到讀到text為止。</p>
</blockquote>
<p><a href="https://blog.xuite.net/tzeng015/twblog/113272117-File&#43;descriptor%E8%88%87I%2FO%E5%B0%8E%E5%90%91" target="_blank" rel="noopener noreffer ">File descriptor與I/O導向 @ 程式專欄 :: 隨意窩 Xuite日誌</a></p>
<p>fd更狂的應用可以看<a href="http://www.polish.url.tw/ech2/ech2.html" target="_blank" rel="noopener noreffer ">阿旺的 Linux 開竅手冊-file descriptor</a><br>
我都不知道<code>/proc/xxxx/fd</code>可以看到所有應用程式 stdin / stdout / stderr 檔案</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 取得cmd 的 PID</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$$</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /proc/<span class="nv">$$</span>/fd/
</span></span><span class="line"><span class="cl">ls -la
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到標準輸入輸出會寫在哪裡<br>
當然裡還還有更多東西，目前先提到這樣</p>
<p>突然想到當初大學上 Linux 時候，老師講 Linux 裡面的東西都可以在檔案找到</p>
<p><a href="http://inspire-future.blogspot.com/2016/12/file-descriptor.html" target="_blank" rel="noopener noreffer ">回憶の隨筆日記: 檔案描述符 (file descriptor) 簡單應用分析</a></p>
<p><a href="https://blog.51cto.com/13097817/2054397" target="_blank" rel="noopener noreffer ">Socket-IO复用技术-SherryX-51CTO博客</a><br>
<a href="https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6" target="_blank" rel="noopener noreffer ">檔案描述符 - 維基百科，自由的百科全書</a></p>
<h3 id="socket-跟-fd-關係">socket 跟 fd 關係?</h3>
<p>其實我以前看 socket 是傳訊息用的，想說他怎麼會跟 fd 有關係</p>
<h4 id="bash-可以用-socket">bash 可以用 socket</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 開啟連線至 Google 網頁的 socket</span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&lt;&gt;/dev/tcp/www.google.com.tw/80
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 送出 HTTP 請求</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;GET / HTTP/1.1\n\n&#34;</span> &gt;<span class="p">&amp;</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 接收網頁內容，1 秒後自動停止接收資料</span>
</span></span><span class="line"><span class="cl">timeout <span class="m">1</span> cat &lt;<span class="p">&amp;</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 關閉輸入與輸出 socket</span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&lt;<span class="p">&amp;</span>-
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&gt;<span class="p">&amp;</span>-
</span></span></code></pre></td></tr></table>
</div>
</div><p>這時候可以去看 <code>/dev/xxx/fd/3</code> 可以看到這個檔案<br>
不過我不確定別的程式語言建立 socket 會不會產生這個檔案??</p>
<p>我使用 <code>php -S 0.0.0.0:80</code> 建立簡單的 Server<br>
使用<code>ps aux | grep php</code> 看 PID<br>
進入 <code>/proc/{PID}/fd/</code> 使用 <code>ls -l</code> 可以看到一些檔案參照 socket<br>
但是怎麼知道是輸入還是輸出，我就沒深入研究<br>
所以我研判是 socket 跟 fd 是有關係的(應該 = =a)</p>
<p><a href="https://blog.gtwang.org/programming/bash-tutorial-open-tcp-udp-socket/" target="_blank" rel="noopener noreffer ">Bash 程式設計教學：開啟 TCP/UDP Socket 網路連線 - G. T. Wang</a><br>
<a href="https://blog.longwin.com.tw/2012/09/bash-shell-socket-connect-2012/" target="_blank" rel="noopener noreffer ">Bash shell 連接 Socket 寫法 | Tsung&rsquo;s Blog</a></p>
<p>我發現 zsh 不能實作，要在 bash 裡面一條一條執行才可以<br>
用成 <code>xxx.sh</code> 不能跑，目前沒有深入找這個問題</p>
<p>這讓我想以前 TCP 概論課程有用 <code>telnet</code> 實作 接收 yahoo 網頁<br>
這上面範例應該是 Linux 方法!!</p>
<h3 id="acceptconnectsendrecvcloselistenbind">accept/connect、send/recv、close、listen、bind</h3>
<p><img
        class="lazyload"
        src="/blog/svg/loading.min.svg"
        data-src="./socket.png"
        data-srcset="./socket.png, ./socket.png 1.5x, ./socket.png 2x"
        data-sizes="auto"
        alt="./socket.png"
        title="socket" /></p>
<p>簡單小記一些 function 作用<br>
<code>socket()</code> 建立 socket 用的 fd<br>
<code>bind()</code> socket() 傳回來的 fd 放在 bind 命名<br>
<code>listen()</code> 監聽 socket，但重頭戲在 accept，需要下 accept() 別人才能練近來<br>
<code>accept()</code> 接受別人連線，等 client 發 <code>connect</code><br>
<code>connect()</code> client 發起連線<br>
<code>send() , recv()</code> write read TCP??<br>
<code>sendto() , recvfrom()</code> write read UDP<br>
<code>close</code> 關閉連線</p>
<p>首先，Server 會接收到 Client 資料，所以一開始 Server 會先做 <strong>read</strong>，確定收到資料才會做 write<br>
簡單來講把這個想成 http 就好理解。話說 http 也是 socket o.&lt;</p>
<p>想到這個我想想 socket 有沒有跟 https 憑證加密?<br>
<del>不過網路上查了一下，沒有看到。都是額外用 function library 加密</del><br>
<del>但也不是不能理解，畢竟 socket 介於 應用層 和 傳輸層中間</del><br>
當然有找到使用 openssl ，不過沒有看到別的程式語言用 <a href="https://blog.csdn.net/qq_21111579/article/details/52134507" target="_blank" rel="noopener noreffer ">socket编程之openssl入门 - 我们的征途是星辰大海 - CSDN博客</a><br>
<a href="https://wp.huangshiyang.com/java%E5%AE%9E%E7%8E%B0-ssl%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81-socket" target="_blank" rel="noopener noreffer ">Java实现 SSL双向认证 Socket – Huang Shiyang</a><br>
<a href="https://morioh.com/p/4ee89beb93bd/tls-socket-client-server-in-nodejs" target="_blank" rel="noopener noreffer ">TLS Socket , client &amp; server in NodeJS - Morioh</a><br>
<a href="https://wiki.swoole.com/wiki/page/240.html" target="_blank" rel="noopener noreffer ">1.7.4 SSL隧道加密TCP-Server-Swoole-Swoole文档中心</a><br>
看來還是真的有的&hellip;</p>
<p>題外話:我好奇 socket 是網路7層哪一層，裡面有寫<a href="http://marklin-blog.logdown.com/posts/2366799" target="_blank" rel="noopener noreffer ">Socket 的哩哩扣扣 « Mark Lin Blog</a></p>
<p>更多資訊<br>
<a href="http://zake7749.github.io/2015/03/17/SocketProgramming/" target="_blank" rel="noopener noreffer ">TCP Socket Programming 學習筆記 | 雷德麥的藏書閣</a><br>
<a href="https://legacy.gitbook.com/book/myliao/beej-s-guide-to-network-programming-chinese-zhtw/details" target="_blank" rel="noopener noreffer ">Beej&rsquo;s Guide to Network Programming 正體中文版 · GitBook (Legacy)</a></p>
<p>其實在看 io 複用一直在想為什麼要了解 socket<br>
原來是大有關係，目前我猜測應該是 socket 並非最佳連線，所以才有 io 複用那些解決方案<br>
到下面幾篇有很多都不是很了解，我盡量吸收</p>
<h3 id="接收緩存區發送緩存區阻塞非阻塞超時等概念">接收緩存區、發送緩存區、阻塞/非阻塞、超時等概念</h3>
<p><a href="https://www.jianshu.com/p/d3b6db70ad74" target="_blank" rel="noopener noreffer ">UDP Socket(套接字)——发送接收缓冲区 - 简书</a></p>
<h2 id="io复用">IO复用</h2>
<p><a href="https://www.jianshu.com/p/dfd940e7fca2" target="_blank" rel="noopener noreffer ">聊聊IO多路复用之select、poll、epoll详解 - 簡書</a></p>
<p>說真的我以為講到 IO 應該就會講到硬碟&hellip;<br>
結果都是講 socket 東西<br>
看來這個才是基礎&hellip;</p>
<p>這一塊我不是很了解<br>
簡單看到是在 epoll 比 select 還快<br>
是用監聽事件觀念<br>
這也是為什麼大家推使用 epoll 的 nginx<br>
<a href="https://xiaoyue26.github.io/2017/11/06/2017-11/epoll%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" target="_blank" rel="noopener noreffer ">epoll相关基础知识 | 笔记本</a></p>
<h3 id="同步異步阻塞非阻塞">同步、異步、阻塞、非阻塞</h3>
<p><a href="https://www.jianshu.com/p/aed6067eeac9" target="_blank" rel="noopener noreffer ">聊聊同步、异步、阻塞与非阻塞 - 簡書</a></p>
<p>看裡面的內容，會覺得同步和阻塞不會分辨<br>
我就突然想到 js 的 ajax 是異步，那這個會是阻塞還是不是阻塞?<br>
答案是異步非阻塞<br>
<a href="https://medium.com/@mts40110/js-%E5%90%8C%E6%AD%A5-%E7%95%B0%E6%AD%A5-%E9%98%BB%E5%A1%9E-%E9%9D%9E%E9%98%BB%E5%A1%9E-29e1e1c0193e" target="_blank" rel="noopener noreffer ">JS 同步、異步、阻塞、非阻塞 - Sam - Medium</a><br>
可以看上面連結<br>
寫的還滿清楚的</p>
<h3 id="linux-io">LINUX IO</h3>
<p><a href="https://www.jianshu.com/p/486b0965c296" target="_blank" rel="noopener noreffer ">聊聊Linux 五种IO模型 - 簡書</a></p>
<h2 id="應用">應用</h2>
<p><a href="https://zhuanlan.zhihu.com/p/34279200" target="_blank" rel="noopener noreffer ">Swoole的简单运用 - 知乎</a></p>
<p>看了這麼多還不是很了解，暫時整理到這邊&hellip;orz</p>
<p><strong>2019-10-26</strong></p>
<p>課程小記</p>
<ul>
<li>
<p>Swoole Server</p>
</li>
<li>
<p>HTTP/Websocket Server</p>
</li>
<li>
<p>Task 異步任務<br>
這一快很像 MQ，但要可靠可以用</p>
</li>
<li>
<p>Timer 定時器</p>
</li>
<li>
<p>Memory 模組<br>
講者有提到這邊可以做 Memory Cache<br>
Memory Cache 可在 Redis 前面可做緩衝<br>
減輕Redis 負擔<br>
剛好網路上有找到 Github <a href="https://github.erp.pub/swooliy/memory-cache" target="_blank" rel="noopener noreffer ">GitHub - swooliy/memory-cache: Memory Cache base on swoole</a></p>
</li>
<li>
<p>Process</p>
</li>
<li>
<p>Coroutine</p>
</li>
</ul>
<p>更新 swoole 程式必須要重啟?<br>
需要。但現在有 Docker , K8s 機器所以做更新程式，服務不會中斷<br>
但是 websocket 還是會斷<br>
所以必須要做 websocket 重新連線機制</p>
<p>Websocket 要做 load balance<br>
需要做一個 main server 關聯所有 Websocket Server 溝通橋梁<br>
<del>所有近來不是透過 main server 去做送</del><br>
而是自動直接 load balance 進去到 Websocket Server<br>
要透過發送訊息是 main server 做發送給所有 Websocket Server<br>
去做實作</p>
<p>main Server 雖然沒有講到要用什麼<br>
但我覺得 MQ(RabbitMQ) 用在這上面也是非常不錯的方法</p>
<p>課程有提到<br>
socket.io 跟 websocket 不太一樣<br>
socket.io 有對非支援 websocket 瀏覽器的處理</p>
<p>f</p><div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="2236653478"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  
        </div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2019-09-20</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" data-title="swoole 需要學習前了解一些東西整理小記" data-hashtags="swoole,php"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" data-hashtag="swoole"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" data-title="swoole 需要學習前了解一些東西整理小記"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" data-title="swoole 需要學習前了解一些東西整理小記"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://malagege.github.io/blog/posts/swoole-%E9%9C%80%E8%A6%81%E5%AD%B8%E7%BF%92%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E6%9D%B1%E8%A5%BF%E6%95%B4%E7%90%86%E5%B0%8F%E8%A8%98/" data-title="swoole 需要學習前了解一些東西整理小記"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/blog/tags/swoole/">Swoole</a>,&nbsp;<a href="/blog/tags/php/">Php</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/blog/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/posts/CSS-fullscreen-%E5%85%A8%E8%9E%A2%E5%B9%95%E5%8A%9F%E8%83%BD%E5%B0%8F%E8%A8%98/" class="prev" rel="prev" title="CSS :fullscreen 全螢幕功能小記"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>CSS :fullscreen 全螢幕功能小記</a>
            <a href="/blog/posts/MySQL-%E6%88%91%E5%B0%8D-timestamp-%E5%A4%9A%E5%B9%B4%E7%9A%84%E8%AA%A4%E8%A7%A3/" class="next" rel="next" title="MySQL 我對 timestamp 多年的誤解">MySQL 我對 timestamp 多年的誤解<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.125.4">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/blog/" target="_blank">malagege</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://malagege-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"algoliaAppID":"4LYONZIY18","algoliaIndex":"malagege_blog","algoliaSearchKey":"30dc05f673e702e0701b9b40cfa44eac","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/blog/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-105195903-2', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-105195903-2" async></script></body>
</html>
