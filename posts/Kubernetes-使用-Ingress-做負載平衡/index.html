<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Kubernetes 使用 Ingress 做負載平衡 - 程式狂想筆記</title><meta name="Description" content="記錄著我接觸程式藝文"><meta property="og:title" content="Kubernetes 使用 Ingress 做負載平衡" />
<meta property="og:description" content="最近我在學習 Kubernetes，我有問我 K8S 裡面使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server
我那時後才學到 Service ，Service 是使用 iptable 所以應該無法做到
我剛看到 Ingress 章節，應該是可以做到我朋友需求
但仔細想想，探討這個問題也應該沒有意義
使用 K8S 應該就是使用微服務架構，探討 Server 會不會掛掉或更新， Pod 都一定會重置
搜為網路上看一下， 單獨 Ingress 不是可以做到，需要一個 Ingress Controller 才能做到(這邊這個好像就是 nginx 這種東西)
不過，Ingress 和 Ingress Controller

Ingress 本身並沒有提供負載平衡的功能，還需要透過 Ingress Controller 來實現。Ingress Controller 目前主要支援兩種型別 GCE 與 Nginx，而今天我們將透過 Nginx Ingress Controller 在 Kubernetes Cluster 內部架設 load balancer。

來源: [Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天
2021-02-04
我找到我朋友說的使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server
專有述語叫做 Sticky Session
Nginx Ingress Controller 可以做到

Sticky Sessions - NGINX Ingress Controller
Services - Traefik
Ingress session sticky_总结、分享、交流-CSDN博客
結論還是能做到的
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-11T16:37:01+00:00" />
<meta property="article:modified_time" content="2021-02-11T16:37:01+00:00" /><meta property="og:site_name" content="程式狂想筆記" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Kubernetes 使用 Ingress 做負載平衡"/>
<meta name="twitter:description" content="最近我在學習 Kubernetes，我有問我 K8S 裡面使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server
我那時後才學到 Service ，Service 是使用 iptable 所以應該無法做到
我剛看到 Ingress 章節，應該是可以做到我朋友需求
但仔細想想，探討這個問題也應該沒有意義
使用 K8S 應該就是使用微服務架構，探討 Server 會不會掛掉或更新， Pod 都一定會重置
搜為網路上看一下， 單獨 Ingress 不是可以做到，需要一個 Ingress Controller 才能做到(這邊這個好像就是 nginx 這種東西)
不過，Ingress 和 Ingress Controller

Ingress 本身並沒有提供負載平衡的功能，還需要透過 Ingress Controller 來實現。Ingress Controller 目前主要支援兩種型別 GCE 與 Nginx，而今天我們將透過 Nginx Ingress Controller 在 Kubernetes Cluster 內部架設 load balancer。

來源: [Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天
2021-02-04
我找到我朋友說的使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server
專有述語叫做 Sticky Session
Nginx Ingress Controller 可以做到

Sticky Sessions - NGINX Ingress Controller
Services - Traefik
Ingress session sticky_总结、分享、交流-CSDN博客
結論還是能做到的
"/>
<meta name="application-name" content="程式狂想筆記">
<meta name="apple-mobile-web-app-title" content="程式狂想筆記"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" /><link rel="prev" href="https://malagege.github.io/blog/posts/Kubernetes-%E6%9C%8D%E5%8B%99%E6%8E%A2%E7%B4%A2-Service-Discovery/" /><link rel="next" href="https://malagege.github.io/blog/posts/Kubernetes-%E7%9A%84-ReplicasSet/" /><link rel="stylesheet" href="/blog/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Kubernetes 使用 Ingress 做負載平衡",
        "inLanguage": "zh-tw",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/malagege.github.io\/blog\/posts\/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1\/"
        },"genre": "posts","keywords": "Kubernetes, ingress","wordcount":  1155 ,
        "url": "https:\/\/malagege.github.io\/blog\/posts\/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1\/","datePublished": "2021-02-11T16:37:01+00:00","dateModified": "2021-02-11T16:37:01+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "malagege"
            },"description": "\u003cp\u003e最近我在學習 Kubernetes，我有問我 K8S 裡面使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server\u003cbr\u003e\n我那時後才學到 Service ，Service 是使用 iptable 所以應該無法做到\u003cbr\u003e\n我剛看到 Ingress 章節，應該是可以做到我朋友需求\u003cbr\u003e\n但仔細想想，探討這個問題也應該沒有意義\u003cbr\u003e\n使用 K8S 應該就是使用微服務架構，探討 Server 會不會掛掉或更新， Pod 都一定會重置\u003c/p\u003e\n\u003cp\u003e搜為網路上看一下， 單獨 Ingress 不是可以做到，需要一個 Ingress Controller 才能做到(這邊這個好像就是 nginx 這種東西)\u003cbr\u003e\n不過，Ingress 和 Ingress Controller\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIngress 本身並沒有提供負載平衡的功能，還需要透過 Ingress Controller 來實現。Ingress Controller 目前主要支援兩種型別 GCE 與 Nginx，而今天我們將透過 Nginx Ingress Controller 在 Kubernetes Cluster 內部架設 load balancer。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e來源: \u003ca href=\"https://ithelp.ithome.com.tw/articles/10196261\" target=\"_blank\" rel=\"noopener noreffer \"\u003e[Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2021-02-04\u003c/strong\u003e\u003cbr\u003e\n我找到我朋友說的\u003ccode\u003e使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server\u003c/code\u003e\u003cbr\u003e\n專有述語叫做 \u003ccode\u003eSticky Session\u003c/code\u003e\u003cbr\u003e\nNginx Ingress Controller 可以做到\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://kubernetes.github.io/ingress-nginx/examples/affinity/cookie/\" target=\"_blank\" rel=\"noopener noreffer \"\u003eSticky Sessions - NGINX Ingress Controller\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://doc.traefik.io/traefik/routing/services/#sticky-sessions\" target=\"_blank\" rel=\"noopener noreffer \"\u003eServices - Traefik\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.csdn.net/linuxerlin/article/details/107561912\" target=\"_blank\" rel=\"noopener noreffer \"\u003eIngress session sticky_总结、分享、交流-CSDN博客\u003c/a\u003e\u003cbr\u003e\n結論還是能做到的\u003c/li\u003e\n\u003c/ul\u003e"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/blog/" title="程式狂想筆記">程式狂想筆記</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/blog/"> 首頁 </a><a class="menu-item" href="/blog/posts/"> 文章 </a><a class="menu-item" href="/blog/tags/"> 標籤 </a><a class="menu-item" href="/blog/categories/"> 分類 </a><a class="menu-item" href="/blog/links/" title="覺得不錯好站都會放在這邊"> 好站連結 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/blog/" title="程式狂想筆記">程式狂想筆記</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/blog/" title="">首頁</a><a class="menu-item" href="/blog/posts/" title="">文章</a><a class="menu-item" href="/blog/tags/" title="">標籤</a><a class="menu-item" href="/blog/categories/" title="">分類</a><a class="menu-item" href="/blog/links/" title="覺得不錯好站都會放在這邊">好站連結</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
            <div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="4661282975"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Kubernetes 使用 Ingress 做負載平衡</h1>

        <div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="2236653478"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  <div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/blog/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>malagege</a></span>&nbsp;<span class="post-category">included in <a href="/blog/categories/Kubernetes/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Kubernetes</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-02-11">2021-02-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1155 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#kind-官方設定教學">Kind 官方設定教學</a>
      <ul>
        <li><a href="#對應環境設定-kind">對應環境設定 (Kind)</a></li>
        <li><a href="#安裝-contour-ingress-controller">安裝 Contour (Ingress Controller)</a></li>
        <li><a href="#設定-daemonsets">設定 daemonsets</a></li>
        <li><a href="#使用-ingress">使用 Ingress</a></li>
        <li><a href="#執行內容">執行內容</a></li>
        <li><a href="#查看-ingress-指令">查看 Ingress 指令</a></li>
        <li><a href="#kubernetes之ingress-error-endpoints-default-http-backend-not-found">kubernetes之ingress error: endpoints &ldquo;default-http-backend&rdquo; not found</a></li>
      </ul>
    </li>
    <li><a href="#使用-host-名稱對應-service">使用 host 名稱對應 service</a>
      <ul>
        <li><a href="#使用-minikube">使用 minikube</a></li>
        <li><a href="#service-pod--ingress-設定">service ,pod , ingress 設定</a></li>
        <li><a href="#測試-host-方法">測試 host 方法</a></li>
      </ul>
    </li>
    <li><a href="#ssl-termination代理端做-tls">SSL termination(代理端做 tls)</a></li>
    <li><a href="#運行多個-ingress-controller">運行多個 Ingress Controller</a></li>
    <li><a href="#wildcard-host">wildcard host</a></li>
    <li><a href="#rewrite-url">rewrite url</a></li>
    <li><a href="#感想">感想</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>最近我在學習 Kubernetes，我有問我 K8S 裡面使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server<br>
我那時後才學到 Service ，Service 是使用 iptable 所以應該無法做到<br>
我剛看到 Ingress 章節，應該是可以做到我朋友需求<br>
但仔細想想，探討這個問題也應該沒有意義<br>
使用 K8S 應該就是使用微服務架構，探討 Server 會不會掛掉或更新， Pod 都一定會重置</p>
<p>搜為網路上看一下， 單獨 Ingress 不是可以做到，需要一個 Ingress Controller 才能做到(這邊這個好像就是 nginx 這種東西)<br>
不過，Ingress 和 Ingress Controller</p>
<blockquote>
<p>Ingress 本身並沒有提供負載平衡的功能，還需要透過 Ingress Controller 來實現。Ingress Controller 目前主要支援兩種型別 GCE 與 Nginx，而今天我們將透過 Nginx Ingress Controller 在 Kubernetes Cluster 內部架設 load balancer。</p>
</blockquote>
<p>來源: <a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener noreffer ">[Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a></p>
<p><strong>2021-02-04</strong><br>
我找到我朋友說的<code>使用 load balance 能不能做到 Cookies 第一次指向到某一台 Server</code><br>
專有述語叫做 <code>Sticky Session</code><br>
Nginx Ingress Controller 可以做到</p>
<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/examples/affinity/cookie/" target="_blank" rel="noopener noreffer ">Sticky Sessions - NGINX Ingress Controller</a></li>
<li><a href="https://doc.traefik.io/traefik/routing/services/#sticky-sessions" target="_blank" rel="noopener noreffer ">Services - Traefik</a></li>
<li><a href="https://blog.csdn.net/linuxerlin/article/details/107561912" target="_blank" rel="noopener noreffer ">Ingress session sticky_总结、分享、交流-CSDN博客</a><br>
結論還是能做到的</li>
</ul>
<h2 id="前言">前言</h2>
<p>之前有碰過 traefik ，在使用 docker 情況下 ，traefik 是使用 docker label 去抓設定<br>
我原本以為 K8s 應該也差不多<br>
後來看到 Ingress 跟 Ingress Controller 一直在想這件事情<br>
突然想到 Ingress 應該就控制網站Virtual Server(不確定是不是這樣叫) 設定<br>
Ingress Controller 可能是 Apache , nginx (類似這些東西做反向代理)<br>
這樣換不同 Ingress Controller 也不用重新設定<br>
應該是這樣定位吧(我自己想的)</p>
<p>教學還是建議看 <a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener noreffer ">[Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a><br>
我這邊還是以操作紀錄為主</p>
<p>Kind 由於先前發現做 NodePort 會有問題，這邊用 minikube 可能比較不會出狀況<br>
當然官方也是有方法可以避免<br>
可以看一下官方操作方法<a href="https://kind.sigs.k8s.io/docs/user/ingress/" target="_blank" rel="noopener noreffer ">kind – Ingress</a><br>
主要是 expose port</p>
<h2 id="kind-官方設定教學">Kind 官方設定教學</h2>
<h3 id="對應環境設定-kind">對應環境設定 (Kind)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kind delete cluster <span class="c1"># 確定刪除</span>
</span></span><span class="line"><span class="cl">kubectl config get-context <span class="c1"># 確定使用的 k8s 連結設定</span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | kind create cluster --config=-
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Cluster
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: kind.x-k8s.io/v1alpha4
</span></span></span><span class="line"><span class="cl"><span class="s">nodes:
</span></span></span><span class="line"><span class="cl"><span class="s">- role: control-plane
</span></span></span><span class="line"><span class="cl"><span class="s">  kubeadmConfigPatches:
</span></span></span><span class="line"><span class="cl"><span class="s">  - |
</span></span></span><span class="line"><span class="cl"><span class="s">    kind: InitConfiguration
</span></span></span><span class="line"><span class="cl"><span class="s">    nodeRegistration:
</span></span></span><span class="line"><span class="cl"><span class="s">      kubeletExtraArgs:
</span></span></span><span class="line"><span class="cl"><span class="s">        node-labels: &#34;ingress-ready=true&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  extraPortMappings:
</span></span></span><span class="line"><span class="cl"><span class="s">  - containerPort: 80
</span></span></span><span class="line"><span class="cl"><span class="s">    hostPort: 80
</span></span></span><span class="line"><span class="cl"><span class="s">    protocol: TCP
</span></span></span><span class="line"><span class="cl"><span class="s">  - containerPort: 443
</span></span></span><span class="line"><span class="cl"><span class="s">    hostPort: 443
</span></span></span><span class="line"><span class="cl"><span class="s">    protocol: TCP
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安裝-contour-ingress-controller">安裝 Contour (Ingress Controller)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://projectcontour.io/quickstart/contour.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># namespace/projectcontour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># serviceaccount/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># serviceaccount/envoy created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># configmap/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># customresourcedefinition.apiextensions.k8s.io/extensionservices.projectcontour.io created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># customresourcedefinition.apiextensions.k8s.io/httpproxies.projectcontour.io created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># customresourcedefinition.apiextensions.k8s.io/tlscertificatedelegations.projectcontour.io created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># serviceaccount/contour-certgen created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># rolebinding.rbac.authorization.k8s.io/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># role.rbac.authorization.k8s.io/contour-certgen created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># job.batch/contour-certgen-v1.12.0 created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># clusterrolebinding.rbac.authorization.k8s.io/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># clusterrole.rbac.authorization.k8s.io/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># service/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># service/envoy created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># deployment.apps/contour created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># daemonset.apps/envoy created</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="設定-daemonsets">設定 daemonsets</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;spec&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;template&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;spec&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;nodeSelector&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;ingress-ready&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tolerations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;key&#34;</span><span class="p">:</span> <span class="s2">&#34;node-role.kubernetes.io/master&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;operator&#34;</span><span class="p">:</span> <span class="s2">&#34;Equal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;effect&#34;</span><span class="p">:</span> <span class="s2">&#34;NoSchedule&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl patch daemonsets -n projectcontour envoy -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;template&#34;:{&#34;spec&#34;:{&#34;nodeSelector&#34;:{&#34;ingress-ready&#34;:&#34;true&#34;},&#34;tolerations&#34;:[{&#34;key&#34;:&#34;node-role.kubernetes.io/master&#34;,&#34;operator&#34;:&#34;Equal&#34;,&#34;effect&#34;:&#34;NoSchedule&#34;}]}}}}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先設定，之後代研究這個是做什麼用<br>
但我發現這個沒設定好像也能跑 = =a</p>
<h3 id="使用-ingress">使用 Ingress</h3>
<p>預設好像就有這個，所以不需要特別裝</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hashicorp/http-echo:0.2.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;-text=foo&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Default port used by the image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">5678</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bar-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bar-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hashicorp/http-echo:0.2.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;-text=bar&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bar-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Default port used by the image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">5678</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">foo-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">5678</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">bar-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">5678</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上面建立兩個pod,service，然後新增 Ingress 設定</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/usage.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="執行內容">執行內容</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># should output &#34;foo&#34;</span>
</span></span><span class="line"><span class="cl">curl localhost/foo
</span></span><span class="line"><span class="cl"><span class="c1"># should output &#34;bar&#34;</span>
</span></span><span class="line"><span class="cl">curl localhost/bar
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="查看-ingress-指令">查看 Ingress 指令</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get ingress
</span></span><span class="line"><span class="cl">kubectl describle ingress simple-ingress
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="kubernetes之ingress-error-endpoints-default-http-backend-not-found">kubernetes之ingress error: endpoints &ldquo;default-http-backend&rdquo; not found</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">翻譯：
</span></span><span class="line"><span class="cl">控制器。注意:根據您正在使用的Ingress控制器，您可能需要創建一個default-http-backend服務。
</span></span><span class="line"><span class="cl">違約後端
</span></span><span class="line"><span class="cl">沒有規則的入口將所有流量發送到一個默認後端。默認後端通常是Ingress控制器的一個配置選項，在您的Ingress資源中沒有指定。
</span></span><span class="line"><span class="cl">如果Ingress對象中的主機或路徑都不匹配HTTP請求，則流量將被路由到默認後端。
</span></span></code></pre></td></tr></table>
</div>
</div><p>參考:<a href="https://www.cnblogs.com/zoulixiang/p/13554893.html" target="_blank" rel="noopener noreffer ">kubernetes之ingress error: endpoints &ldquo;default-http-backend&rdquo; not found - Mr.zou - 博客园</a></p>
<h2 id="使用-host-名稱對應-service">使用 host 名稱對應 service</h2>
<p>由於書中跟 <a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener noreffer ">[Day 19] 在 Kubernetes 中實現負載平衡 - Ingress Controller - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a><br>
為了加速實作，這邊使用上面範例</p>
<h3 id="使用-minikube">使用 minikube</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 啟用 minikube 的 ingress</span>
</span></span><span class="line"><span class="cl">minikube addons <span class="nb">enable</span> ingress
</span></span><span class="line"><span class="cl"><span class="c1"># 取得 minikube ip</span>
</span></span><span class="line"><span class="cl">minikube ip
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service-pod--ingress-設定">service ,pod , ingress 設定</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 建立測試 pod</span>
</span></span><span class="line"><span class="cl">kubectl create -f  https://raw.githubusercontent.com/zxcvbnius/k8s-30-day-sharing/master/Day19/demo-ingress/helloworld-pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>事後想想這邊可以用上面範例 echo 出不同字串<br>
這樣就可以知道用到哪一個 pod</p>
<p>建立兩個測試用 serivce 都倒同一個 service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-pod</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-pod</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl create -f https://raw.githubusercontent.com/zxcvbnius/k8s-30-day-sharing/master/Day19/demo-ingress/helloworld-service.yaml
</span></span><span class="line"><span class="cl">kubectl get svc
</span></span><span class="line"><span class="cl"><span class="c1"># Name:              helloworld-v1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Namespace:         default</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Labels:            &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Annotations:       &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Selector:          app=helloworld-pod</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Type:              ClusterIP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IP Families:       &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IP:                10.96.172.11</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IPs:               &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Port:              &lt;unset&gt;  3000/TCP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># TargetPort:        3000/TCP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Endpoints:         172.17.0.7:3000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Session Affinity:  None</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Events:            &lt;none&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Name:              helloworld-v2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Namespace:         default</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Labels:            &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Annotations:       &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Selector:          app=helloworld-pod</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Type:              ClusterIP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IP Families:       &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IP:                10.96.251.221</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IPs:               &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Port:              &lt;unset&gt;  3000/TCP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># TargetPort:        3000/TCP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Endpoints:         172.17.0.7:3000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Session Affinity:  None</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Events:            &lt;none&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>確認是否成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 進去 node 確認狀況</span>
</span></span><span class="line"><span class="cl">minikube ssh
</span></span><span class="line"><span class="cl"><span class="c1"># 確認 pods 可以正常連到</span>
</span></span><span class="line"><span class="cl">curl 10.96.172.11:3000
</span></span></code></pre></td></tr></table>
</div>
</div><p>繼續建立 ingress controller</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 官方安裝 nginx ingress controller</span>
</span></span><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.44.0/deploy/static/provider/baremetal/deploy.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># 原作yaml 無法建立</span>
</span></span><span class="line"><span class="cl"><span class="c1"># error: error validating &#34;https://raw.githubusercontent.com/zxcvbnius/k8s-30-day-sharing/master/Day19/demo-ingress/nginx-ingress.yaml&#34;: error validating data: [ValidationError(Ingress.metadata): unknown field &#34;kubernetes.io/ingress.class&#34; in io.k8s.apimachinery.pkg.apis.meta.v1.ObjectMeta, ValidationError(Ingress.spec.rules[0]): unknown field &#34;paths&#34; in io.k8s.api.extensions.v1beta1.IngressRule]; if you choose to ignore these errors, turn validation off with --validate=false</span>
</span></span><span class="line"><span class="cl">vim nginx-ingress.yaml 
</span></span></code></pre></td></tr></table>
</div>
</div><p>參考 <a href="https://github.com/zxcvbnius/k8s-30-day-sharing/blob/master/Day19/demo-ingress/ingress-example-2.yaml" target="_blank" rel="noopener noreffer ">k8s-30-day-sharing/ingress-example-2.yaml at master · zxcvbnius/k8s-30-day-sharing</a><br>
裡面 service name 有錯誤，建議使用下面複製</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v1.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v2.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="測試-host-方法">測試 host 方法</h3>
<ol>
<li>
<p>curl -H<br>
之前<a href="https://malagege.github.io/blog/posts/%E5%9C%A8-Raspberry-PI-%E6%9E%B6%E8%A8%AD-Traefik-%E5%88%9D%E9%AB%94%E9%A9%97/#%E6%B8%AC%E8%A9%A6%E6%96%B9%E6%B3%95" target="_blank" rel="noopener noreffer ">在 Raspberry PI 架設 Traefik 初體驗 | 程式狂想筆記</a>這篇有紀錄<br>
通常改 /etc/hosts 檔案或者curl 指令可以做到(這當初看到 traefik 官方文件寫的，還滿神奇的，畢竟很多教學沒這樣教)</p>
</li>
<li>
<p>/etc/hosts</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 這個 IP 是 node IP</span>
</span></span><span class="line"><span class="cl">curl -H Host:helloworld-v1.example.com http://192.168.99.102/  
</span></span><span class="line"><span class="cl">curl -H Host:helloworld-v2.example.com http://192.168.99.102/  
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ssl-termination代理端做-tls">SSL termination(代理端做 tls)</h2>
<p>ingress-ssl-sceret.yaml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls.crt</span><span class="p">:</span><span class="w"> </span><span class="l">YmFzZTY0X2VuY29kZWRfY2VydA==</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls.key</span><span class="p">:</span><span class="w"> </span><span class="l">YmFzZTY0X2VuY29kZWRfa2V5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ssh-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Opaque</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>example3-ingress.yaml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">ssh-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">helloworld-v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="運行多個-ingress-controller">運行多個 Ingress Controller</h2>
<p>一個叢集中運行多個Ingress 控制器，可以搭配 Annotation 的 <code>kubernetes.io/ingress.class</code><br>
如果沒有配置 <code>kubernetes.io/ingress.class</code>，會有多個不同Ingress Controller 搶 Ingress 使用權，並寫入Ingress 件的status 欄位</p>
<p>後面兩個就不先仔細研究</p>
<h2 id="wildcard-host">wildcard host</h2>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#hostname-wildcards" target="_blank" rel="noopener noreffer ">Ingress | Kubernetes</a></p>
<h2 id="rewrite-url">rewrite url</h2>
<p><a href="https://www.qikqiak.com/post/url-rewrite-on-ingress-nginx/" target="_blank" rel="noopener noreffer ">ingress-nginx 中 Rewrite 的使用-阳明的博客|Kubernetes|Istio|Prometheus|Python|Golang|云原生</a></p>
<h2 id="感想">感想</h2>
<p>之前有操作 Traefik 使用 Docker Label 讓 Traefik 可以自動抓到想要的 host<br>
使用 Ingress 來看，這個設計能做到模組化分離，可算非常棒!!</p>
<p>以後有用到 Traefik  Ingress 再回來填坑</p><div align="center">
    <script
      async
      src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1439458814178865" crossorigin="anonymous"
    ></script>
    <ins
      class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-1439458814178865"
      data-ad-slot="2236653478"
    ></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  
        </div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-02-11</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" data-title="Kubernetes 使用 Ingress 做負載平衡" data-hashtags="Kubernetes,ingress"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" data-hashtag="Kubernetes"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" data-title="Kubernetes 使用 Ingress 做負載平衡"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" data-title="Kubernetes 使用 Ingress 做負載平衡"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://malagege.github.io/blog/posts/Kubernetes-%E4%BD%BF%E7%94%A8-Ingress-%E5%81%9A%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/" data-title="Kubernetes 使用 Ingress 做負載平衡"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/blog/tags/Kubernetes/">Kubernetes</a>,&nbsp;<a href="/blog/tags/ingress/">Ingress</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/blog/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/posts/Kubernetes-%E6%9C%8D%E5%8B%99%E6%8E%A2%E7%B4%A2-Service-Discovery/" class="prev" rel="prev" title="Kubernetes 服務探索(Service Discovery)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Kubernetes 服務探索(Service Discovery)</a>
            <a href="/blog/posts/Kubernetes-%E7%9A%84-ReplicasSet/" class="next" rel="next" title="Kubernetes 的 ReplicaSet">Kubernetes 的 ReplicaSet<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.124.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/blog/" target="_blank">malagege</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://malagege-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"algoliaAppID":"4LYONZIY18","algoliaIndex":"malagege_blog","algoliaSearchKey":"30dc05f673e702e0701b9b40cfa44eac","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/blog/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-105195903-2', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-105195903-2" async></script></body>
</html>
